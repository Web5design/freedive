<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Freedive 0.1 - Generate embeddable filter tables from Google Docs data</title>
<link href="styles/demo_style.css" rel="stylesheet" type="text/css">

<link href="styles/freeDive.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.smartWizard-2.0.min.js"></script>


<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript" src="js/iframe_top.js"></script>
<script type="text/javascript">  google.load('visualization', '1.1', {packages:['controls']});
</script>

<script type="text/javascript">
    $(document).ready(function(){
    	// Smart Wizard 	
        $('#wizard').smartWizard(
         {
          // Properties
            selected: 0,  // Selected Step, 0 = first step   
            keyNavigation: true, // Enable/Disable key navigation(left and right keys are used if enabled)
            enableAllSteps: false,  // Enable/Disable all steps on first load
            transitionEffect: 'fade', // Effect on navigation, none/fade/slide/slideleft
            contentURL:null, // specifying content url enables ajax content loading
            contentCache:true, // cache step contents, if false content is fetched always from ajax url
            cycleSteps: false, // cycle step navigation
            enableFinishButton: false, // makes finish button enabled always
            errorSteps:[],    // array of step numbers to highlighting as error steps
            labelNext:'Next', // label for Next button
            labelPrevious:'Previous', // label for Previous button
            labelFinish:'Finish',  // label for Finish button
                    
          // Events
            onLeaveStep: leaveAStepCallback, // triggers when leaving a step
            onShowStep: null,  // triggers when showing a step
            onFinish: onFinishCallback  // triggers when Finish button is clicked
         }
        );
      
      function onFinishCallback(){
        $('#wizard').smartWizard('showMessage','Finish Clicked');
        // alert('Finish Clicked');
      } 

      function leaveAStepCallback(obj){
        // This function gets called after each step and appends new params to the URL
        var step_num= obj.attr('rel'); // get the current step number

		 if(step_num == 1){

	            return true; // Return true so that navigation continues
	
	
		} else if(step_num == 2) {

            return true; // Return true so that navigation continues

        
        } else if(step_num == 3) {
            
            // Turn spinner on before we go and try to retrieve data
            $('#colfetch_spinner').show();  

            // Take input from step 1 and insert vals into the DOM so they're available in step 2
            spreadsheet_id = $('input[id=sheet_id_field]').val();
            $('#sheet_id').html(spreadsheet_id);
            getTableMeta(spreadsheet_id);
            
            return true; // Return true so that navigation continues


        } else if(step_num == 4) {

            // Need to make a new columns object that contains just
            // the checked columns (unlike cols_orig which contains all cols from spreadsheet).
            // This is tricky because the previous form element only sends the column IDs,
            // while we need both IDs and values, and we need the passed columns array
            // to have the same format as the original one.
            
            // Step through the checked columns, find the equivalent element
            // in orig_cols, and make it a key/val pair in the new object.   
            // Also build up a cols_as_text string for display in next step.
            
            columns = {}; 
            cols_as_text = '';
            $("input[name='cols_use']:checked").each(function(){
                temp = orig_cols[$(this).val()];  
                columns[$(this).val()] = {label: temp.label};  
                cols_as_text += temp.label + ",";
            });  
            
            // Strip trailing comma from cols_as_text and send to HTML
            cols_as_text = cols_as_text.slice(0, -1)
            $('#cols_arr').html(cols_as_text);


			// Populate dropdowns for step 5 from new array of usable columns
			populateDropDown(columns,'#pick_sortby_col');
			populateDropDown(columns,'#pick_main_col');  


            return true; // Return true so that navigation continues
            
              
        } else if(step_num == 5) {
                
            // Populate step 6 dropdowns when leaving step 5
            populateDropDown(columns,'#pick_results_filter');
            populateDropDown(columns,'#pick_results_text');
            populateDropDown(columns,'#pick_results_slider');            


    		// Store selected values for next step
    		filter_col = $('select#filter_col').val();      
				
 			
            
            return true; // Return true so that navigation continues

		} else if(step_num == 6) {
			
				// Collect inputs from step 6 
	            filter_col = $('select#filter_col').val();
	            filter_label = $('input[id=filter_label]').val();
	            picker_col = $('select#picker_col').val();
	            picker_label = $('input[id=picker_label]').val();
	            slider_col = $('select#slider_col').val();
	            slider_label = $('input[id=slider_label]').val(); 
				;

            return true; // Return true so that navigation continues
			
		} else if(step_num == 7) {
			
					// Collect inputs from step 7
					table_width = $('input[id=table_width]').val();
					table_height = $('input[id=table_height]').val();
					
					sheet_limit="&range=A1:F6"; // for testing remove before publishing
				      
					embed_text = 
		                "Spreadsheet ID: " + spreadsheet_id + "\n" +
		                "Columns: " + cols_as_text + "\n" +                
		                "Search column: " + filter_col + "\n" +
		                "Search label: " + filter_label + "\n" +
		                "Filter column: " + picker_col + "\n" +
		                "Filter label: " + picker_label + "\n" +
		                "Range column: " + slider_col + "\n" +
		                "Range label: " + slider_label + "\n" +
						"Table Width: " + table_width + "\n" +
						"Table Height: " + table_height + "\n" 
		            ;
					
					
					embed_actual = "&ltscript type=&apos;text/javascript&apos;src=&apos;https://www.google.com/jsapi&apos;&gt&lt/script&gt&ltscript type=&apos;text/javascript&apos;&gtgoogle.load(&apos;visualization&apos;,&apos;1.1&apos;,{packages:[&apos;controls&apos;]});&lt/script&gt&ltstyle type=&apos;text/css&apos;&gtdiv.control1{width:100%;padding: 0 0 20px 0;font-size:0.9em;color:black;}div.control2{height:30px;width:400px;font-size:0.9em;padding: 0 20px 20px 0;float:left;}div.control3{float:right;height:30px;font-size:0.9em;vertical-align:inherit;}div.chart1{float: left;}&lt/style&gt&ltscript type=&apos;text/javascript&apos;&gtfunction drawVisualization(){var query=new google.visualization.Query(&apos;https://spreadsheets.google.com/a/google.com/tq?key="+spreadsheet_id+"&tq=select%20" + cols_as_text+sheet_limit+"&apos;);query.send(handleQueryResponse);}function handleQueryResponse(response){if (response.isError()){alert(&apos;Error in query: &apos;+response.getMessage() +&apos; &apos; +response.getDetailedMessage());return;}var data=response.getDataTable();var slider=new google.visualization.ControlWrapper({&apos;controlType&apos;: &apos;NumberRangeFilter&apos;, &apos;containerId&apos;: &apos;control1&apos;, &apos;options&apos;:{&apos;filterColumnLabel&apos;:&apos;" +slider_col+"&apos;, &apos;ui&apos;:{&apos;label&apos;:&apos;"+ slider_label+"&apos;, }}});var stringFilter=new google.visualization.ControlWrapper({&apos;controlType&apos;: &apos;StringFilter&apos;, &apos;containerId&apos;: &apos;control2&apos;, &apos;options&apos;:{&apos;filterColumnLabel&apos;:&apos"+ +filter_col+"&apos;,&apos;matchType&apos;:&apos;any&apos;,&apos;ui&apos;:{&apos;label&apos;:&apos;"+filter_label+"&apos;, }}});var categoryPicker=new google.visualization.ControlWrapper({&apos;controlType&apos;: &apos;CategoryFilter&apos;, &apos;containerId&apos;: &apos;control3&apos;, &apos;options&apos;:{&apos;filterColumnLabel&apos;:&apos;"+ picker_col+"&apos;, &apos;ui&apos;:{&apos;label&apos;:&apos;"+picker_label+"&apos;, &apos;allowTyping&apos;: false, &apos;allowMultiple&apos;: false, }}});var table=new google.visualization.ChartWrapper({&apos;chartType&apos;: &apos;Table&apos;, &apos;containerId&apos;: &apos;chart1&apos;, &apos;options&apos;:{&apos;height&apos;:&apos;"+table_height+"px&apos;, &apos;width&apos;:&apos;"+table_width+"px&apos;, &apos;allowHtml&apos;:&apos;true&apos;, }});var dashboard=new google.visualization.Dashboard(document.getElementById(&apos;dashboard&apos;)).  bind([stringFilter,categoryPicker, slider], table).  draw(data);}google.setOnLoadCallback(drawVisualization);&lt/script&gt&ltdiv id='dashboard' style='width:"+table_width+"px; font-family:Arial, sans-serif;'&gt&ltdiv id='control1' class='control1'&gt&lt/div&gt&ltdiv id='control3'class='control3'&gt&lt/div&gt&ltdiv id='control2' class='control2'&gt&lt/div&gt&ltdiv id='chart1' class='chart1'&gt&lt/div&gt&lt/div&gt";
					
					
					iframe_actual = iframe_start+embed_actual+"&lt/body&gt&lt/html&gt";
					
					// Send it!
					$('#table_embed_text').html(embed_actual);
					$('widget_embed_text').html(embed_text);
		

            return true; // Return true so that navigation continues

		} else if(step_num == 8) {  

            return true; // Return true so that navigation continues
   
        } else {
            return true; // Continue anyway
        }
        
      }      
      
  
          
		});

</script>

</head><body>

<style type="text/css" media="screen">
    input {
        height:20px;
        font-family:Tahoma;
        font-size:18px;
        color:#606060;
    }     
    
    input#sheet_id_field {
        width:450px;
    }               
    
    input[type="button"] {
        height:40px;
    }
    
    label {
        font-weight:bold;
    }
    
    textarea {
        width:600px;
        height:300px;
    }
    
    .help_text {
        font-size:0.9em;
        font-style:italic;
        margin-top:20px;
		line-height: 1.3em;
    }
	
	.sub_head_fd {
		font-size:1.3em;
        font-weight:bold;
        margin-top:20px;
		line-height: 1.4em;	
	}
	
	.label_fd {
		font-size:1em;
        font-weight:bold;
        margin-top:20px;
		padding-bottom:20px;
		line-height: 1.1em;
	}
	
	.input_fd {
        margin-top:10px;
		margin-bottom:5px;
	}

</style>


<table align="center" border="0" cellpadding="0" cellspacing="0">
<tr><td> 
<!-- Smart Wizard -->
  		<div id="wizard" class="swMain">
  			<ul>
  				<li><a href="#step-1">
                <label class="stepNumber">1</label>
            </a></li>
  				<li><a href="#step-2">
                <label class="stepNumber">2</label>
            </a></li>
  				<li><a href="#step-3">
                <label class="stepNumber">3</label>                  
             </a></li>
  				<li><a href="#step-4">
                <label class="stepNumber">4</label>
            </a></li>
				<li><a href="#step-5">
                <label class="stepNumber">5</label>
            </a></li>
				<li><a href="#step-6">
                <label class="stepNumber">6</label>
            </a></li>
				<li><a href="#step-7">
                <label class="stepNumber">7</label>
            </a></li>
				<li><a href="#step-8">
            	<label class="stepNumber">8</label>
	        </a></li>
				<li><a href="#step-9">
	            <label class="stepNumber">9</label>
	        </a></li>
  			</ul>
				<div id="step-1">	
	            <h2 class="StepTitle">Get ready...</h2>

	            <p>For the best results, clean and edit your spreadsheet before you use this tool. If you don’t know how to clean data, <a href="http://multimedia.journalism.berkeley.edu/tutorials/cleaning-data/">read our tutorial</a>. Here are some things to keep in mind:</p>
				<div style="width:440px; height:180px;float:left">
				<h3 class="sub_head_fd">Requirements</h3>
					<ul style="padding:0 0 0 15px">
						<li>You must have at least one column of numbers.</li>
						<li>You must have a single row of column labels. Multiple label rows will break the tool.</li>
						<li>Format special characters such as thousand separators (,) and currency signs ($) in the Google Spreadsheet.</li>
						<li>The spreadsheet must have exactly one worksheet (the default).</li>
						</ul>	
				</div>
				
				<div style="width:440px; height:250px; float:right">
				<h3 class="sub_head_fd">Recommendations</h3>
					<ul style="padding:0 0 0 15px">
						<li>Optimize your data for the Web for better performance. Delete everything you don’t need from your Google spreadsheet, including columns you don’t plan to publish and blank rows.</li>
						<li>Arrange your columns in the order in which you would like them displayed.</li>
						<li>Use a finished spreadsheet. If you must edit the Google spreadsheet, changes in will update auto- matically in the published graph. But editing can introduce errors that can break your table.</li>
						<li>Do not use all caps text. It requires additional space and makes your chart harder to read.</li>
						</ul>	
				</div>	

	        </div>
	
				<div id="step-2">	
	            <h2 class="StepTitle">Get set...</h2>

				<div style="width:200px; height:250px; float:left">
					<ol style="padding:0 0 0 15px;font-weight:bold;">
	            <li><span style="font-weight:normal">Click the File menu and select Publish to the Web. Make sure Automatically republish changes is checked and click Start publishing. <br /><a href"URL">EXAMPLE</a></span></li>
	<br/>
				<li><span style="font-weight:normal">Open your Google Spreadsheet and click the Share button in the top right. Make the document viewable to anyone on the Web. <br /><a href"URL">EXAMPLE</a></span></li>
	           </ol>
           </div>




	       </div>
	
  			<div id="step-3">	
            <h2 class="StepTitle">Enter your spreadsheet ID</h2>
            
            <p>With your spreadsheet open, look in the URL for the term “key=” This will be followed by a unique ID made of letters and numbers. Copy just the ID and paste in the field below.</p>
			<img src="images/freeDive-key.png">
            


         	<h3 class="sub_head_fd">Spreadsheet ID:</h3>
         	<p>
            <div id="spreadsheet_id"></div>
            <input id="sheet_id_field" value="">  
            <input type="button" id="sidtest" value="Test">
            <span id="sidtest_spinner"><img src="images/loader.gif" width="20" height="20" alt="Loader"></span>
            </p>
                        

			<p><em>TIP: If you want to work with the campaign contributions example, select the key in this link (text in bold):<br/>
			<code>https://docs.google.com/spreadsheet/ccc?key=<b>0AtP_YtDJ532RdDcxZUl6Zkl4YkxKcEYzbld4ZDA4SlE</b>&hl=en_US#gid=0</code></em></p>
            <p><strong>Before continuing, please use the Test button to verify that we can work with your spreadsheet.</strong></p>

        </div>     
        
        
        
        
  			<div id="step-4">
            <h2 class="StepTitle">Select your columns</h2>	

			<p>You are working on spreadsheet: <strong><span id="sheet_id">&nbsp;</span></strong>. It contains <strong><span id="need_col_nums"></span></strong> columns. Check the ones you want to include in your table.</p>
			<p><em>TIP: Make sure to limit your columns to fit where you plan to publish your table. If your story area is 600 pixels wide, limit the number of columns to five or so. Too many columns in a small space can be very hard to read. EXAMPLE If you need to dislpay more columns, consider publishing on a full page so that the text is easier to scan.</em></p>
            
            
            <p>
                Please select the columns you want to display (five columns max).</p>    
                
            <p id="colfetch_spinner"><img src="images/loader.gif" width="20" height="20" alt="Loader"> Retrieving column data...</p> 
            
            <style type="text/css" media="screen">
                input[type='checkbox'] {
                    display:inline;
                    width:20px;
                }
                
                td {
                    width:300px;
                }
            </style>

            <p id="col_load_spinner"></p>
            
            <table>

                <tbody>
                    <tr id="colnames">
                        <!-- Cells populated by jQuery -->
                    </tr>
                    
                    <tr id="colids">
                        <!-- Column IDs populated by jQuery -->                        
                    </tr>

                 </tbody>
            </table>

            <div id="col_no_warn" class="alert"></div>

      
            
                    
        </div>                      
  			<div id="step-5">
            <h2 class="StepTitle">Decide what the user will search</h2>	

			<p>Take some time to consider what you want your readers to find. What will be the most relevant for them? You must fill out all selections</p>
            
            <!-- <p>Working with columns: <span id="cols_arr">&nbsp;</span></p> -->
            
            <table>
    
                                     <tr style="vertical-align:top;">
	
									
                                         <td>
											<h3 class="sub_head_fd">Select a column for text search</h3>
											<p>Users can only search within a text column.</p>
                                             <p>
	
                                         		<select id="pick_main_col">
					                               <!-- Options generated with jQuery -->
	                                                       
                                                 </select>
                                             </p>

                                             </p>
                     						
                                         </td>
                                         
                                         <td>
                                            <h3 class="sub_head_fd">Select a column for numeric search</h3>
											<p>Your table must have at least one column with numbers. They will be able to select "less than," "greater than," etc.    
                                             </p>
											<p>
                                                 <select id="pick_sortby_col">
                                                   <!-- Options generated with jQuery -->
					                                                                                      
                                                 </select>
                                             </p>

                                         </td>
                                         	<td>
	                     						<h3 class="sub_head_fd">Invite your users to search</h3>
	                                             <p>The table will start with a widget that allows readers to search the entire database. Fill out the following:    
	                                             </p>

	                     						<label for="head_5">Headline</label><br />
	                     						<input class="input_fd" id="head_5" value=""><br />
												<span class="help_text">e.g. "Search all contributions"</span><br /><br />
	                     						<label class="label_fd" for="leadin_5">Lead-in</label><br />
	                     						<input class="input_fd" id="leadin_5" value=""><br />	
												<span class="help_text">Invite users to search the data. Include some examples to get them started. e.g. "Enter the name of a contributor to find donations. For example, type in "Fred" or "Flintstone."</span>
	                                         </td>
                                         
                                                             
                                     </tr>
                                 </table>
            
       

         </div>
  		
		<div id="step-6">
            <h2 class="StepTitle">Set up the user results page</h2>
            	
            <p>FreeDive includes interactive filters on the results page. This allows your readers to refine their results. This is especially helpful with large databases. You must choose one column for each filter. To see the three types in use, check out this example.
            </p>

	            <table>
	                <tr style="vertical-align:top">
	                    <td><h3 class="sub_head_fd">Select a column for text filtering</h3>
	                        <p>
	                            <label for="pick_results_text">Field to use for text searches:</label><br />
	                            <select id="pick_results_text">
                                    <!-- Options populated with jQuery -->

	                            </select>
	                        </p>

	                        <p>
	                            <label for="filter_label">Label for search:</label><br />
	                            <input class="input_fd" type=text id="filter_label" value=""><br />
	                            <span class="help_text">e.g. "Search for a contributor by name:"</span>
	                        </p>
							<p style="width:200px"> Allows users to search within a text column. For example, they can search for part of a name or a ZIP Code.
							</p>
	                    </td>

	                    <td><h3 class="sub_head_fd">Select a column for category picker</h3>
	                        <p>
	                            <label for="pick_results_filter">Field to enable for filtering:</label><br />
	                            <select id="pick_results_filter">
                                    <!-- Options populated with jQuery -->                                                        

	                            </select>
	                        </p>

	                        <p>
	                            <label for="picker_label">Label for filter:</label><br />
	                            <input class="input_fd" id="picker_label" value=""><br />
	                            <span class="help_text">e.g. "Pick a city:"</span>
	                        </p>
							<p style="width:200px"> Allows users to select a category from a drop down menu. <em>TIP: Every attribute will be added to the picker list so use columns with limited attributes.</em>
							</p>
	                    </td>


	                    <td><h3 class="sub_head_fd">Select a column for a range slider</h3>
	                        <p>
	                            <label for="pick_results_slider">Field to enable for range slider:</label><br />
	                            <select id="pick_results_slider">
                                   <!-- Options populated with jQuery --> 

	                            </select>
	                        </p>

	                        <p>
	                            <label for="slider_label">Label for filter:</label><br />
	                            <input class="input_fd" id="slider_label" value=""><br />
	                            <span class="help_text">e.g. "Adjust dollar range of contributions:"</span>
	                        </p>
							<p style="width:200px"> Creates a slider tool so that users can change which range of data is included in the results.
							</p>
	                    </td>                    
	                </tr>
		            </table>

		</div>
		
  		<div id="step-7">
            <h2 class="StepTitle">Size</h2>
            	
            <p>Setting the size of your chart is very important. It directly impacts how your reader interacts with your data. Make it too small and the the value of the data is diminished in their eyes. Make it too big and it will overwhelm and scare them away.
            </p>
           	<h3 class="sub_head_fd">Width in pixels</h3>
			<input id="table_width" value="600"> 
			<p><em>TIP: We recommend that you make your chart the full width of your regular story or post content. This helps it integrate the table into your site. If you must display 7-10 columns, you may have to make the table the full width of your page.</em></p>
			
			<h3 class="sub_head_fd">Height in pixels</h3>
			<input id="table_height" value="400">
           <p><em>TIP: If the chart will be above a story, consider setting the height to 300-400 pixels. For example, this wizard is 450 pixels high so that if we need to display text below you will still be able to see it. If your table will stand alone on a page, 800 pixels or more of depth will give the reader access to more data and may be better.</em></p>
               			
        </div>

  			<div id="step-8">
            <h2 class="StepTitle">Congratulations! You’re done...</h2>

			<div id="table_embed" style="width:440px; float:left">
				<h3 class="sub_head_fd">Embed code</h3>
				<p>Copy and paste this code into a or blog in HTML mode to display your table. The code is mainly javascript (which some platforms restrict) so you may have to ask someone with admin access to post it for you.</p>
				<textarea id="table_embed_text" style="width:435px; height:150px"></textarea>
				
			</div>
			
			<div id="widget_embed" style="width:440px; float:right">
				<h3 class="sub_head_fd">Iframe</h3>
				<p>You can choose to download your table as an html document. This table uses the FreeDive theme and looks a little better. It also makes it easier for you to customize the CSS to match your site.</p>
		            <textarea id="widget_embed_text" style="width:150px; height:20px; position:absolute;left:620px" ></textarea>
		            <input type="button" value="Download HTML" onclick="downloadTable()" /><br /><br />
					<span class="help_text"><b>Instructions</b><ol><li>After download, rename the file to <b>"yourname.html"</b> and upload it to your web server. Note the URL (web address) of where it's located.</li><li>Copy the code below and paste it into a web page.</li><li>Replace the <b>URL</b> text in the code with the URL of your uploaded html page.</li></ol> <br/> <code>&ltiframe src="<b>URL</b>" width="100%" height="300"&gt
					  &ltp>Your browser does not support iframes.&lt/p&gt
					&lt/iframe&gt</code> </span>
			</div>
        </div>

  		<div id="step-9">
            <h2 class="StepTitle">Step 4 Embed code</h2>
            	
            <p>Paste the embed code below into your story or blog post in HTML mode:
            </p>
            <textarea id="table_embed_text" style="width:435px; height:150px"></textarea> 			
        </div>

  	</div>
<!-- End SmartWizard Content -->  		
 		
</td></tr>
</table>

<script type="text/javascript" charset="utf-8">

		function downloadTable(){
						
			uriContent = "data:application/octet-stream," + encodeURIComponent(document.getElementById('widget_embed_text').value);			
			location.href = uriContent;
		};
		
		// function previewTable(){
		// 	uriContent = "data:application/octet-stream," + encodeURIComponent(document.getElementById('widget_embed_text').value);
		// 	newWindow=window.open(uriContent, 'neuesDokument');
		//  
		// }
</script>
		
<script type="text/javascript" charset="utf-8">

	$.extend({
      getUrlVars: function(){
        var vars = [], hash;
        var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
        for(var i = 0; i < hashes.length; i++)
        {
          hash = hashes[i].split('=');
          vars.push(hash[0]);
          vars[hash[0]] = hash[1];
        }
        return vars;
      },
      getUrlVar: function(name){
        return $.getUrlVars()[name];
      }
    });

</script>


<script type="text/javascript" charset="utf-8">
    // In-wizard functions
    
    // Populate any known parameters from URL
    var spreadsheet_id = $.getUrlVar('sid');
    $('input[id=sheet_id_field]').val(spreadsheet_id);  

    // Initially hide the loading spinners, then toggle on as needed
    $('#sidtest_spinner').hide();
    $('#colfetch_spinner').hide();    
    
    // Test SID for validity - throws an alert if SID is inaccessible. 
    $('input[id=sidtest]').click(function () { 
       $('#sidtest_spinner').show();           
       var testsid = $('input[id=sheet_id_field]').val();
       validateTable(testsid);                 

    });
        


    // Populate sets of original column checkboxes 
    function populateColCells(orig_cols) {
        $.each(orig_cols, function(column, value) { 
          $("tr#colnames").append('<td>' + value.label + '</td>');        
        });
    }
    
    function populateColIDCells(orig_cols) {
        $.each(orig_cols, function(column, value) { 
          $("tr#colids").append('<td><input type="checkbox" name="cols_use" value="'+ column +'" /></td>');        
        });
    }   
    
    
    // Dropdown lists of columns appear at several places in the wizard, populated either with
    // the original list of columns or a subset. This function populates them as needed. 
    // Takes an object of column data to use and a CSS selector as args.
    function populateDropDown(cols_ob,selector) { 
        $.each(cols_ob, function(column, value) { 
          $(selector).append('<option value="'+ column +'">'+ value.label +'</option>');        
        });
    }  
    
    			
    
    // Warn if user tries to select more than five columns
    function limitCols() {
    $('input[name=cols_use]').click(function () {
    selected = $('input[name="cols_use"]').filter(':checked').length;
    if (selected > 5){
        $('#wizard').smartWizard('showMessage','You have selected more than five columns');
            } else {
        $('div.msgBox').hide();
        }
      });
    }
</script>    


<script type="text/javascript" charset="utf-8">   

    // Validate spreadsheet ID step #1 (similar to getTableMeta)
    function validateTable(spreadsheet_id,response) {
		var query = new google.visualization.Query('https://spreadsheets.google.com/a/google.com/tq?key=' + spreadsheet_id);
    	query.send(validateQueryResponse);
        
    	}

    // Validate spreadsheet ID step #2 (similar to handleQueryResponse but without all the extra processing)
	function validateQueryResponse(response) {
        if (response.isError()) {
            alert('Error in query: ' + response.getMessage() +  '. Please click Previous and enter a different spreadsheet ID.');
           
        } else {
            alert('Spreadsheet is valid and accessible!');

        }
        // Always turn off the spinner after the tests.
        $('#sidtest_spinner').hide();   
    }
    


    // Get table metadata from Google
    function getTableMeta(spreadsheet_id,response) {
	    
    	// ------------ Load data from google docs ----------------
		var query = new google.visualization.Query('https://spreadsheets.google.com/a/google.com/tq?key=' + spreadsheet_id);
    	query.send(handleQueryResponse);
        
    	}

	function handleQueryResponse(response) {
        // Validation removed - we should always be working with a valid spreadsheet at this point.

        var data = response.getDataTable();
        var colNum = data.getNumberOfColumns();
        var rowNum = data.getNumberOfRows();

        // All columns into an "orig_cols" map (object literal)
        orig_cols = {};
        for (var i = 0; i < colNum; i++) {
            var key = data.B[i].id;
            orig_cols[key] = {
                label: data.B[i].label
            };
        } 
        
        // Populate original column cells with returned data
        // Make sure user doesn't select more than n columns
        populateColCells(orig_cols);
        populateColIDCells(orig_cols);
        limitCols();       


        // Example: How to iterate through cols array:
        // for(var col_id in orig_cols) {
        //  var label = orig_cols[col_id].label;
        //  console.log(col_id,label);
        // }  
        
        // Turn off the spinner after data is loaded
        $('#colfetch_spinner').hide();    
        
	}
	
	
	

</script>
</body>
</html>
