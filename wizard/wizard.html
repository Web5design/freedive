<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Freedive 0.1 - Generate embeddable filter tables from Google Docs data</title>
<link href="styles/demo_style.css" rel="stylesheet" type="text/css">

<link href="styles/freeDive.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.smartWizard-2.0.min.js"></script>


<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
//Load the #D6D6D6 API and the controls package.  
  google.load('visualization', '1.1', {packages:['controls']});
</script>

<script type="text/javascript">
    $(document).ready(function(){
    	// Smart Wizard 	
        $('#wizard').smartWizard(
         {
          // Properties
            selected: 0,  // Selected Step, 0 = first step   
            keyNavigation: true, // Enable/Disable key navigation(left and right keys are used if enabled)
            enableAllSteps: false,  // Enable/Disable all steps on first load
            transitionEffect: 'fade', // Effect on navigation, none/fade/slide/slideleft
            contentURL:null, // specifying content url enables ajax content loading
            contentCache:true, // cache step contents, if false content is fetched always from ajax url
            cycleSteps: false, // cycle step navigation
            enableFinishButton: false, // makes finish button enabled always
            errorSteps:[],    // array of step numbers to highlighting as error steps
            labelNext:'Next', // label for Next button
            labelPrevious:'Previous', // label for Previous button
            labelFinish:'Finish',  // label for Finish button
                    
          // Events
            onLeaveStep: leaveAStepCallback, // triggers when leaving a step
            onShowStep: null,  // triggers when showing a step
            onFinish: onFinishCallback  // triggers when Finish button is clicked
         }
        );
      
      function onFinishCallback(){
        $('#wizard').smartWizard('showMessage','Finish Clicked');
        // alert('Finish Clicked');
      } 

      function leaveAStepCallback(obj){
        // This function gets called after each step and appends new params to the URL
        var step_num= obj.attr('rel'); // get the current step number

		 if(step_num == 1){

	            return true; // Return true so that navigation continues
	
	
		} else if(step_num == 2) {

            return true; // Return true so that navigation continues

        
        } else if(step_num == 3) {

            // Take input from step 1 and insert vals into the DOM so they're available in step 2
            spreadsheet_id = $('input[id=sidfield]').val();
            $('#s2_sid').html(spreadsheet_id);
            getTableMeta(spreadsheet_id);
            
            return true; // Return true so that navigation continues


        } else if(step_num == 4) {
            
            // Take column selector input from step 2 and append checked column names to "columns" array
            var columns = new Array();
            $("input[name='usecols']:checked").each(function(){
                columns.push($(this).val());
            });
            
            // Can't send an array into html - need to convert array to string
            cols_as_text = columns.join(",");
            $('#s3_col_arr').html(cols_as_text);
            return true; // Return true so that navigation continues
            
              
        } else if(step_num == 5) {

            // Collect inputs from step 3 
            search_col = $('select#search_col').val();
            search_label = $('input[id=search_label]').val();
            filter_col = $('select#filter_col').val();
            filter_label = $('input[id=filter_label]').val();
            range_col = $('select#range_col').val();
            range_label = $('input[id=range_label]').val();                                                            

            embed_text = 
                "Spreadsheet ID: " + spreadsheet_id + "\n" +
                "Columns: " + cols_as_text + "\n" +                
                "Search column: " + search_col + "\n" +
                "Search label: " + search_label + "\n" +
                "Filter column: " + filter_col + "\n" +
                "Filter label: " + filter_label + "\n" +
                "Range column: " + range_col + "\n" +
                "Range label: " + range_label + "\n" 
            ;
            
            // Send it!
            $('#s4_embed_text').html(embed_text);
            
            return true; // Return true so that navigation continues

		} else if(step_num == 6) {

            return true; // Return true so that navigation continues
			
		} else if(step_num == 7) {

            return true; // Return true so that navigation continues

		} else if(step_num == 8) {

            return true; // Return true so that navigation continues
   
        } else {
            return true; // Continue anyway
        }
        
      }      
      
  
          
		});

</script>

</head><body>

<style type="text/css" media="screen">
    input {
        height:20px;
        font-family:Tahoma;
        font-size:18px;
        color:#606060;
    }
    
    label {
        font-weight:bold;
    }
    
    textarea {
        width:600px;
        height:300px;
    }
    
    .help_text {
        font-size:0.9em;
        font-style:italic;
        margin-top:15px;
    }

</style>


<table align="center" border="0" cellpadding="0" cellspacing="0">
<tr><td> 
<!-- Smart Wizard -->
  		<div id="wizard" class="swMain">
  			<ul>
  				<li><a href="#step-1">
                <label class="stepNumber">1</label>
            </a></li>
  				<li><a href="#step-2">
                <label class="stepNumber">2</label>
            </a></li>
  				<li><a href="#step-3">
                <label class="stepNumber">3</label>                  
             </a></li>
  				<li><a href="#step-4">
                <label class="stepNumber">4</label>
            </a></li>
				<li><a href="#step-5">
                <label class="stepNumber">5</label>
            </a></li>
				<li><a href="#step-6">
                <label class="stepNumber">6</label>
            </a></li>
				<li><a href="#step-7">
                <label class="stepNumber">7</label>
            </a></li>
				<li><a href="#step-8">
            	<label class="stepNumber">8</label>
	        </a></li>
				<li><a href="#step-9">
	            <label class="stepNumber">9</label>
	        </a></li>
				<li><a href="#step-10">
	            <label class="stepNumber">10</label>
	        </a></li>
  			</ul>
				<div id="step-1">	
	            <h2 class="StepTitle">Get ready...</h2>

	            <p>For the best results, clean and edit your spreadsheet before you use this tool. If you don’t know how to clean data, <a href="http://multimedia.journalism.berkeley.edu/tutorials/cleaning-data/">read our tutorial</a>. Here are some things to keep in mind:</p>
				<div style="width:440px; height:180px;float:left">
				<h3>Requirements</h2>
					<ul style="padding:0 0 0 15px">
						<li>You must have at least one column of numbers.</li>
						<li>You must have a single row of column labels. Multiple label rows will break the tool.</li>
						<li>Format special characters such as thousand separators (,) and currency signs ($) in the Google Spreadsheet.</li>
						<li>The spreadsheet must have exactly one worksheet (the default).</li>
						</ul>	
				</div>
				
				<div style="width:440px; height:250px; float:right">
				<h3>Recommendations</h2>
					<ul style="padding:0 0 0 15px">
						<li>Optimize your data for the Web for better performance. Delete everything you don’t need from your Google spreadsheet, including columns you don’t plan to publish and blank rows.</li>
						<li>Arrange your columns in the order in which you would like them displayed.</li>
						<li>Use a finished spreadsheet. If you must edit the Google spreadsheet, changes in will update auto- matically in the published graph. But editing can introduce errors that can break your table.</li>
						<li>Do not use all caps text. It requires additional space and makes your chart harder to read.</li>
						</ul>	
				</div>	

	        </div>
	
				<div id="step-2">	
	            <h2 class="StepTitle">Get set...</h2>

				<div style="width:200px; height:250px; float:left">
					<ol style="padding:0 0 0 15px;font-weight:bold;">
	            <li><span style="font-weight:normal">Click the File menu and select Publish to the Web. Make sure Automatically republish changes is checked and click Start publishing. <br /><a href"URL">EXAMPLE</a></span></li>
	<br/>
				<li><span style="font-weight:normal">Open your Google Spreadsheet and click the Share button in the top right. Make the document viewable to anyone on the Web. <br /><a href"URL">EXAMPLE</a></span></li>

	           </ol>
</div>



	        </div>
	
  			<div id="step-3">	
            <h2 class="StepTitle">Enter your spreadsheet ID</h2>
            
            <p>With your spreadsheet open, look in the URL for the term “key=” This will be followed by a unique ID made of letters and numbers. Copy just the ID and paste in the field below.</p>
			<img src="file:///Users/ldegroot/Desktop/wizard/images/freeDive-key.png">
            

         	<h3>Spreadsheet ID:</h3>
            <div id="spreadsheet_id"></div>
            <input id="sidfield" value="">
                        

			<p><em>TIP: If you want to work with an example, select the key (text in bold) in this link:<br/>
			<code>https://docs.google.com/spreadsheet/ccc?key=<b>0AqaXaxpnzZkNdEJtUDZoTENnSE1JekpCWEZMXzhnNmc</b>&amp;hl=en_US#gid=7</code></em></p>

          			
        </div>
  			<div id="step-4">
            <h2 class="StepTitle">Select your columns</h2>	

			<p>You are working on spreadsheet: <strong><span id="s2_sid">&nbsp;</span></strong>. It contains <strong><span id="need_col_nums"></span></strong> columns. Check the ones you want to include in your table.</p>
			<p><em>TIP: Make sure to limit your columns to fit where you plan to publish your table. If your story area is 600 pixels wide, limit the number of columns to five or so. Too many columns in a small space can be very hard to read. EXAMPLE If you need to dislpay more columns, consider publishing on a full page so that the text is easier to scan.</em></p>
            
            
            <p>
                Please select the columns you want to display (five columns max).</p>
            
            <style type="text/css" media="screen">
                input[type='checkbox'] {
                    display:inline;
                    width:20px;
                }
                
                td {
                    width:300px;
                }
            </style>
            
            <table>

                <tbody>
                    <tr id="colnames">
                        <!-- Cells populated by jQuery -->
                    </tr>
                    
                    <tr id="colids">
                        <!-- Column IDs populated by jQuery -->                        
                    </tr>

                 </tbody>
            </table>

            <div id="col_no_warn" class="alert"></div>

      
            
                    
        </div>                      
  			<div id="step-5">
            <h2 class="StepTitle">Set up the initial search</h2>	

			<p>Take some time to consider what you want your readers to see and do when they first see your table. Do you want them to see the top 20 political contributors in your database? Or do you want to show them items with the best or worst ratings?</p>
            
            <p>Working with columns: <span id="s3_col_arr">&nbsp;</span></p>
            
            <table>
                <tr>
                    <td>
                        <p>
                            <label for="search_col">Field to use for text searches:</label><br />
                            <select id="search_col">
                              <option value="A">Bike</option>
                              <option value="B">Car</option>
                              <option value="C">Bus</option>
                              <option value="D">Scooter</option>
                              <option value="E">Train</option>              
                              <option value="F">Hovercraft</option>                            
                              <option value="G">Pogo Stick</option>                            
                              <option value="H">Elephant</option>                                                        
                            </select>
                        </p>

                        <p>
                            <label for="search_label">Label for search:</label><br />
                            <input id="search_label" value=""><br />
                            <span class="help_text">e.g. "Search for a contributor by name:"</span>
                        </p>
                    </td>
                    
                    <td>
                        <p>
                            <label for="filter_col">Field to enable for filtering:</label><br />
                            <select id="filter_col">
                              <option value="A">Bike</option>
                              <option value="B">Car</option>
                              <option value="C">Bus</option>
                              <option value="D">Scooter</option>
                              <option value="E">Train</option>              
                              <option value="F">Hovercraft</option>                            
                              <option value="G">Pogo Stick</option>                            
                              <option value="H">Elephant</option>                                                        
                            </select>
                        </p>

                        <p>
                            <label for="filter_label">Label for filter:</label><br />
                            <input id="filter_label" value=""><br />
                            <span class="help_text">e.g. "Pick a city:"</span>
                        </p>
                    </td>
                    
                    
                    <td>
                        <p>
                            <label for="range_col">Field to enable for range slider:</label><br />
                            <select id="range_col">
                              <option value="A">Bike</option>
                              <option value="B">Car</option>
                              <option value="C">Bus</option>
                              <option value="D">Scooter</option>
                              <option value="E">Train</option>              
                              <option value="F">Hovercraft</option>                            
                              <option value="G">Pogo Stick</option>                            
                              <option value="H">Elephant</option>                                                        
                            </select>
                        </p>

                        <p>
                            <label for="range_label">Label for filter:</label><br />
                            <input id="range_label" value=""><br />
                            <span class="help_text">e.g. "Adjust dollar range of contributions:"</span>
                        </p>
                    </td>                    
                </tr>
            </table>
            
       
        
			<h3 style="-webkit-margin-after: 0;">Search invitation: The table will include a widget that allows readers to search the entire database. Fill out the following: </h3>
			<div style="width:200px; float:left;">
			<h3>Headline: <span style="font-weight:normal">A call to action</span></h3>
			<div id="XXXXXX"></div>
			<input id="XXXXXXX" value="">
			</div>  
			<div style="width:680px; float:right">
			<h3>Lead-in: <span style="font-weight:normal;">Invite users to search the data. Include some examples to get them started.</span></h3>
			<div id="XXXXXX"></div>
			<input id="XXXXXXX" value="">
			</div>      

         </div>
  			<div id="step-6">
            <h2 class="StepTitle">Set up the user results page</h2>
            	
            <p>FreeDive includes interactive filters on the results page. This allows your readers to refine their results. This is especially helpful with large databases. If you do not choose a column, the filter will be omitted from the results page. To see the three types in use, look at this example.
            </p>
            
           
               			
        </div>

		</div>
  			<div id="step-7">
            <h2 class="StepTitle">Size</h2>
            	
            <p>Setting the size of your chart is very important. It directly impacts how your reader interacts with your data. Make it too small and the the value of the data is diminished in their eyes. Make it too big and it will overwhelm and scare them away.
            </p>
           	<h3>Width</h3>
			<div id="XXXXXX"></div>
			<input id="XXXXXXX" value=""> 
			<p><em>TIP: We recommend that you make your chart the full width of your regular story or post content. This helps it integrate the table into your site. If you must display 7-10 columns, you may have to make the table the full width of your page.</em></p>
			
			<h3>Height</h3>
			<div id="XXXXXX"></div>
			<input id="XXXXXXX" value="">
           <p><em>TIP: If the chart will be above a story, consider setting the height to 300-400 pixels. For example, this wizard is 450 pixels high so that if we need to display text below you will still be able to see it. If your table will stand alone on a page, 1,000 pixels or more will give the reader access to more data and may be better.</em></p>
               			
        </div>

		</div>
  			<div id="step-8">
            <h2 class="StepTitle">Step 4 Embed code</h2>
            	
            <p>Paste the embed code below into your story or blog post in HTML mode:
            </p>
            
            <textarea id="s4_embed_text"></textarea>
               			
        </div>

		</div>
  			<div id="step-9">
            <h2 class="StepTitle">Step 4 Embed code</h2>
            	
            <p>Paste the embed code below into your story or blog post in HTML mode:
            </p>
            
            <textarea id="s4_embed_text"></textarea>
               			
        </div>
  		</div>
<!-- End SmartWizard Content -->  		
 		
</td></tr>
</table>

<script type="text/javascript" charset="utf-8">
    // Plugin to allow parsing of URL parameters via http://kdmc.us/oDWxGy

	$.extend({
      getUrlVars: function(){
        var vars = [], hash;
        var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
        for(var i = 0; i < hashes.length; i++)
        {
          hash = hashes[i].split('=');
          vars.push(hash[0]);
          vars[hash[0]] = hash[1];
        }
        return vars;
      },
      getUrlVar: function(name){
        return $.getUrlVars()[name];
      }
    });

</script>


<script type="text/javascript" charset="utf-8">
    // In-wizard functions
    
    // Populate any known parameters from URL
    var spreadsheet_id = $.getUrlVar('sid');
    $('input[id=sidfield]').val(spreadsheet_id);


    // Populate set of column checkboxes from query results
    function populateColCells(orig_cols) {
        $.each(orig_cols, function(column, value) { 
          $("tr#colnames").append('<td>' + value.label + '</td>');        
        });
    }
    
    function populateColIDCells(orig_cols) {
        $.each(orig_cols, function(column, value) { 
          $("tr#colids").append('<td><input type="checkbox" name="usecols" value="'+ column +'" /></td>');        
        });
    }    
    
    
    // Warn if user tries to select more than five columns
    function limitCols() {
    $('input[name=usecols]').click(function () {
    selected = $('input[name="usecols"]').filter(':checked').length;
    if (selected > 5){
        $('#wizard').smartWizard('showMessage','You have selected more than five columns');
            } else {
        $('div.msgBox').hide();
        }
      });
    }
</script>    


<script type="text/javascript" charset="utf-8">
    // Get table metadata from Google
    function getTableMeta(spreadsheet_id,response) {
	    
    	// ------------ Load data from google docs ----------------
		var query = new google.visualization.Query('https://spreadsheets.google.com/a/google.com/tq?key=' + spreadsheet_id);
    	query.send(handleQueryResponse);
        
    	}

	function handleQueryResponse(response) {
        if (response.isError()) {
            alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage() + '. Please click Previous and enter a different spreadsheet ID.');
        }

        var data = response.getDataTable();
        var colNum = data.getNumberOfColumns();
        var rowNum = data.getNumberOfRows();

        // All columns into an "orig_cols" map (object literal)
        orig_cols = {};
        for (var i = 0; i < colNum; i++) {
            var key = data.B[i].id;
            orig_cols[key] = {
                label: data.B[i].label
            };
        } 
        
        // Populate original column cells with returned data
        // Make sure user doesn't select more than n columns
        populateColCells(orig_cols);
        populateColIDCells(orig_cols);
        limitCols();       


        // Example: How to iterate through cols array:
        // for(var col_id in cols) {
        //  var label = cols[col_id].label;
        //  console.log(col_id,label);
        // }
	}

</script>
</body>
</html>
